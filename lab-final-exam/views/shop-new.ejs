<!-- Shop Page -->
<div class="shop-wrapper">
    <!-- Shop Header -->
    <div class="shop-header">
        <div class="shop-header-content">
            <h1 class="shop-title">PREMIUM COLLECTION</h1>
            <p class="shop-subtitle">Discover our exclusive range of horse riding equipment and accessories</p>
            <div class="shop-breadcrumb">
                <a href="/">Home</a>
                <span>/</span>
                <span>Shop</span>
            </div>
        </div>
    </div>

    <!-- Trust Badges -->
    <div class="trust-badges">
        <div class="badge-item">
            <i class="fas fa-check-circle"></i>
            <strong>Authentic</strong>
            <span>100% Genuine</span>
        </div>
        <div class="badge-item">
            <i class="fas fa-truck"></i>
            <strong>Fast Delivery</strong>
            <span>Quick Dispatch</span>
        </div>
        <div class="badge-item">
            <i class="fas fa-shield-alt"></i>
            <strong>Secure</strong>
            <span>Protected Payment</span>
        </div>
        <div class="badge-item">
            <i class="fas fa-redo"></i>
            <strong>Easy Returns</strong>
            <span>30-Day Guarantee</span>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <div class="filters-container">
            <h3 class="filters-title"><i class="fas fa-filter"></i> FILTER PRODUCTS</h3>
            <form action="/shop" method="GET" class="filters-form">
                <div class="filter-group">
                    <label><i class="fas fa-list"></i> Category</label>
                    <select name="category">
                        <option value="">All Categories</option>
                        <option value="Riding Equipment" <%= filter.category == 'Riding Equipment' ? 'selected' : '' %>>Riding Equipment</option>
                        <option value="Apparel" <%= filter.category == 'Apparel' ? 'selected' : '' %>>Apparel</option>
                        <option value="Horse Care" <%= filter.category == 'Horse Care' ? 'selected' : '' %>>Horse Care</option>
                        <option value="Stable Supplies" <%= filter.category == 'Stable Supplies' ? 'selected' : '' %>>Stable Supplies</option>
                        <option value="Accessories" <%= filter.category == 'Accessories' ? 'selected' : '' %>>Accessories</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label><i class="fas fa-dollar-sign"></i> Price Range</label>
                    <div class="price-inputs">
                        <input type="number" name="min" placeholder="Min" value="<%= filter.min %>" class="price-input">
                        <span>to</span>
                        <input type="number" name="max" placeholder="Max" value="<%= filter.max %>" class="price-input">
                    </div>
                </div>

                <div class="filter-buttons">
                    <button type="submit" class="btn-filter apply"><i class="fas fa-check"></i> Apply Filters</button>
                    <a href="/shop" class="btn-filter reset"><i class="fas fa-times"></i> Clear All</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Products Grid -->
    <div class="shop-container">
        <% if (products && products.length > 0) { %>
            <div class="products-grid">
                <% products.forEach(product => { %>
                    <div class="product-card">
                        <!-- Product Image -->
                        <div class="product-image-wrapper">
                            <img src="<%= product.image %>" alt="<%= product.name %>" class="product-image" onerror="this.src='/images/placeholder.jpg'">
                            <span class="product-category"><%= product.category %></span>
                            <button class="wishlist-btn" title="Add to Wishlist">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>

                        <!-- Product Info -->
                        <div class="product-info">
                            <h3 class="product-name"><%= product.name %></h3>
                            
                            <!-- Rating -->
                            <div class="product-rating">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                </div>
                                <span class="rating-count">(48 reviews)</span>
                            </div>

                            <!-- Description -->
                            <p class="product-description"><%= product.description || 'Premium quality product for equestrian enthusiasts.' %></p>

                            <!-- Stock Info -->
                            <div class="product-stock">
                                <div class="stock-bar">
                                    <div class="stock-fill" style="width: 85%;"></div>
                                </div>
                                <span class="stock-text">In Stock (45 items)</span>
                            </div>

                            <!-- Price -->
                            <div class="product-price-section">
                                <span class="product-price">$<%= product.price %></span>
                                <span class="product-original-price">$<%= (product.price * 1.2).toFixed(2) %></span>
                            </div>

                            <!-- Action Buttons -->
                            <div class="product-actions">
                                <form action="/cart/add/<%= product._id %>" method="POST" style="flex: 1;">
                                    <button type="submit" class="btn-add-to-cart">
                                        <i class="fas fa-shopping-cart"></i> Add to Cart
                                    </button>
                                </form>
                                <button class="btn-details" onclick='showProductDetails(`<%= product._id %>`, `<%= product.name %>`, `<%= product.image %>`, `<%= product.price %>`, `<%= product.category %>`, `<%= product.description || "" %>`)'>
                                    <i class="fas fa-eye"></i> View
                                </button>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="no-products">
                <i class="fas fa-inbox"></i>
                <h2>No Products Found</h2>
                <p>Try adjusting your filters or browse our full collection</p>
                <a href="/shop" class="btn-back">Back to Shop</a>
            </div>
        <% } %>
    </div>
</div>

<!-- Product Details Modal -->
<div id="productModal" class="product-modal">
    <div class="modal-content">
        <button class="modal-close">&times;</button>
        <div class="modal-body">
            <div class="modal-image">
                <img id="modalImage" src="" alt="">
            </div>
            <div class="modal-info">
                <h2 id="modalTitle"></h2>
                <div class="modal-rating">
                    <div class="stars">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                    </div>
                    <span>(48 reviews)</span>
                </div>
                <p id="modalCategory" class="modal-category"></p>
                <p id="modalDescription" class="modal-description"></p>
                <div class="modal-price">
                    <span id="modalPrice" class="price"></span>
                    <span id="modalOriginalPrice" class="original-price"></span>
                </div>
                <button id="modalAddBtn" class="btn-add-to-cart">
                    <i class="fas fa-shopping-cart"></i> Add to Cart
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Product Details Modal
    function showProductDetails(id, name, image, price, category, description) {
        document.getElementById('modalImage').src = image;
        document.getElementById('modalTitle').textContent = name;
        document.getElementById('modalCategory').textContent = category;
        document.getElementById('modalDescription').textContent = description || 'Premium quality product for equestrian enthusiasts.';
        document.getElementById('modalPrice').textContent = '$' + price;
        document.getElementById('modalOriginalPrice').textContent = '$' + (parseFloat(price) * 1.2).toFixed(2);
        
        document.getElementById('modalAddBtn').onclick = function() {
            fetch('/cart/add/' + id, { method: 'POST' })
                .then(() => {
                    alert('Added to cart!');
                    document.getElementById('productModal').classList.remove('active');
                });
        };
        
        document.getElementById('productModal').classList.add('active');
    }

    document.querySelector('.modal-close').addEventListener('click', function() {
        document.getElementById('productModal').classList.remove('active');
    });

    document.getElementById('productModal').addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.remove('active');
        }
    });

    // Wishlist toggle
    document.querySelectorAll('.wishlist-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            this.querySelector('i').classList.toggle('far');
            this.querySelector('i').classList.toggle('fas');
        });
    });
</script>
